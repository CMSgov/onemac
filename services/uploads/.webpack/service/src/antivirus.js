(()=>{var ee={921:(T,A,E)=>{"use strict";E.r(A),E.d(A,{ATTACHMENTS_BUCKET:()=>M,CLAMAV_BUCKET_NAME:()=>p,FRESHCLAM_CONFIG:()=>c,FRESHCLAM_WORK_DIR:()=>i,MAX_FILE_SIZE:()=>C,PATH_TO_AV_DEFINITIONS:()=>f,PATH_TO_CLAMAV:()=>l,PATH_TO_FRESHCLAM:()=>s,STATUS_CLEAN_FILE:()=>n,STATUS_ERROR_PROCESSING_FILE:()=>o,STATUS_INFECTED_FILE:()=>u,STATUS_SKIPPED_FILE:()=>g,TMP_DOWNLOAD_PATH:()=>t,VIRUS_SCAN_STATUS_KEY:()=>y,VIRUS_SCAN_TIMESTAMP_KEY:()=>S});var O=E(49);const a=require("process");var _=E.n(a);const M=_().env.ATTACHMENTS_BUCKET,p=_().env.CLAMAV_BUCKET_NAME,f=_().env.PATH_TO_AV_DEFINITIONS,s="/opt/bin/freshclam",l="/opt/bin/clamscan",c="/opt/bin/freshclam.conf",i="/tmp/",t="/tmp/download/",n=_().env.STATUS_CLEAN_FILE||"CLEAN",u=_().env.STATUS_INFECTED_FILE||"INFECTED",o=_().env.STATUS_ERROR_PROCESSING_FILE||"ERROR",g=_().env.STATUS_SKIPPED_FILE||"SKIPPED",y=_().env.VIRUS_SCAN_STATUS_KEY||"virusScanStatus",S=_().env.VIRUS_SCAN_TIMESTAMP_KEY||"virusScanTimestamp",C=_().env.MAX_FILE_SIZE||"314572800"},622:(T,A,E)=>{"use strict";E.r(A),E.d(A,{cleanupFolder:()=>s,extractBucketFromApiEvent:()=>t,extractBucketFromS3Event:()=>c,extractKeyFromApiEvent:()=>i,extractKeyFromS3Event:()=>l,generateSystemMessage:()=>n,generateTagSet:()=>f});var O=E(49),a=E.n(O),_=E(81),M=E.n(_),p=E(921);function f(u){return{TagSet:[{Key:p.VIRUS_SCAN_STATUS_KEY,Value:u},{Key:p.VIRUS_SCAN_TIMESTAMP_KEY,Value:new Date().getTime().toString()}]}}function s(u){let o=(0,_.execSync)(`ls -l ${u}`);console.log("-- Folder before cleanup--"),console.log(o.toString()),(0,_.execSync)(`rm -rf ${u}*`),o=(0,_.execSync)(`ls -l ${u}`),console.log("-- Folder after cleanup --"),console.log(o.toString())}function l(u){const o=u.Records[0].s3.object.key;if(!o)throw new Error("Unable to retrieve key information from the event");return decodeURIComponent(o).replace(/\+/g," ")}function c(u){const o=u.Records[0].s3.bucket.name;if(!o)throw new Error("Unable to retrieve bucket information from the event");return o}function i(u){const o=u.s3Key;if(!o)throw new Error("Unable to retrieve key information from the api event");return o.replace(/\+/g," ")}function t(u){const o=u.s3Bucket;if(!o)throw new Error("Unable to retrieve bucket information from the api event");return o}function n(u){const o=`--- ${u} ---`;return console.log(o),o}},358:T=>{var A=Object.prototype.toString,E=typeof Buffer<"u"&&typeof Buffer.alloc=="function"&&typeof Buffer.allocUnsafe=="function"&&typeof Buffer.from=="function";function O(p){return A.call(p).slice(8,-1)==="ArrayBuffer"}function a(p,f,s){f>>>=0;var l=p.byteLength-f;if(l<0)throw new RangeError("'offset' is out of bounds");if(s===void 0)s=l;else if(s>>>=0,s>l)throw new RangeError("'length' is out of bounds");return E?Buffer.from(p.slice(f,f+s)):new Buffer(new Uint8Array(p.slice(f,f+s)))}function _(p,f){if((typeof f!="string"||f==="")&&(f="utf8"),!Buffer.isEncoding(f))throw new TypeError('"encoding" must be a valid string encoding');return E?Buffer.from(p,f):new Buffer(p,f)}function M(p,f,s){if(typeof p=="number")throw new TypeError('"value" argument must not be a number');return O(p)?a(p,f,s):typeof p=="string"?_(p,f):E?Buffer.from(p):new Buffer(p)}T.exports=M},560:(T,A,E)=>{var O=E(870),a=Object.prototype.hasOwnProperty,_=typeof Map<"u";function M(){this._array=[],this._set=_?new Map:Object.create(null)}M.fromArray=function(f,s){for(var l=new M,c=0,i=f.length;c<i;c++)l.add(f[c],s);return l},M.prototype.size=function(){return _?this._set.size:Object.getOwnPropertyNames(this._set).length},M.prototype.add=function(f,s){var l=_?f:O.toSetString(f),c=_?this.has(f):a.call(this._set,l),i=this._array.length;(!c||s)&&this._array.push(f),c||(_?this._set.set(f,i):this._set[l]=i)},M.prototype.has=function(f){if(_)return this._set.has(f);var s=O.toSetString(f);return a.call(this._set,s)},M.prototype.indexOf=function(f){if(_){var s=this._set.get(f);if(s>=0)return s}else{var l=O.toSetString(f);if(a.call(this._set,l))return this._set[l]}throw new Error('"'+f+'" is not in the set.')},M.prototype.at=function(f){if(f>=0&&f<this._array.length)return this._array[f];throw new Error("No element indexed by "+f)},M.prototype.toArray=function(){return this._array.slice()},A.I=M},114:(T,A,E)=>{var O=E(128),a=5,_=1<<a,M=_-1,p=_;function f(l){return l<0?(-l<<1)+1:(l<<1)+0}function s(l){var c=(l&1)===1,i=l>>1;return c?-i:i}A.encode=function(c){var i="",t,n=f(c);do t=n&M,n>>>=a,n>0&&(t|=p),i+=O.encode(t);while(n>0);return i},A.decode=function(c,i,t){var n=c.length,u=0,o=0,g,y;do{if(i>=n)throw new Error("Expected more digits in base 64 VLQ value.");if(y=O.decode(c.charCodeAt(i++)),y===-1)throw new Error("Invalid base64 digit: "+c.charAt(i-1));g=!!(y&p),y&=M,u=u+(y<<o),o+=a}while(g);t.value=s(u),t.rest=i}},128:(T,A)=>{var E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");A.encode=function(O){if(0<=O&&O<E.length)return E[O];throw new TypeError("Must be between 0 and 63: "+O)},A.decode=function(O){var a=65,_=90,M=97,p=122,f=48,s=57,l=43,c=47,i=26,t=52;return a<=O&&O<=_?O-a:M<=O&&O<=p?O-M+i:f<=O&&O<=s?O-f+t:O==l?62:O==c?63:-1}},668:(T,A)=>{A.GREATEST_LOWER_BOUND=1,A.LEAST_UPPER_BOUND=2;function E(O,a,_,M,p,f){var s=Math.floor((a-O)/2)+O,l=p(_,M[s],!0);return l===0?s:l>0?a-s>1?E(s,a,_,M,p,f):f==A.LEAST_UPPER_BOUND?a<M.length?a:-1:s:s-O>1?E(O,s,_,M,p,f):f==A.LEAST_UPPER_BOUND?s:O<0?-1:O}A.search=function(a,_,M,p){if(_.length===0)return-1;var f=E(-1,_.length,a,_,M,p||A.GREATEST_LOWER_BOUND);if(f<0)return-1;for(;f-1>=0&&M(_[f],_[f-1],!0)===0;)--f;return f}},677:(T,A,E)=>{var O=E(870);function a(M,p){var f=M.generatedLine,s=p.generatedLine,l=M.generatedColumn,c=p.generatedColumn;return s>f||s==f&&c>=l||O.compareByGeneratedPositionsInflated(M,p)<=0}function _(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}_.prototype.unsortedForEach=function(p,f){this._array.forEach(p,f)},_.prototype.add=function(p){a(this._last,p)?(this._last=p,this._array.push(p)):(this._sorted=!1,this._array.push(p))},_.prototype.toArray=function(){return this._sorted||(this._array.sort(O.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},A.H=_},892:(T,A)=>{function E(_,M,p){var f=_[M];_[M]=_[p],_[p]=f}function O(_,M){return Math.round(_+Math.random()*(M-_))}function a(_,M,p,f){if(p<f){var s=O(p,f),l=p-1;E(_,s,f);for(var c=_[f],i=p;i<f;i++)M(_[i],c)<=0&&(l+=1,E(_,l,i));E(_,l+1,i);var t=l+1;a(_,M,p,t-1),a(_,M,t+1,f)}}A.U=function(_,M){a(_,M,0,_.length-1)}},612:(T,A,E)=>{var O,a=E(870),_=E(668),M=E(560).I,p=E(114),f=E(892).U;function s(t,n){var u=t;return typeof t=="string"&&(u=a.parseSourceMapInput(t)),u.sections!=null?new i(u,n):new l(u,n)}s.fromSourceMap=function(t,n){return l.fromSourceMap(t,n)},s.prototype._version=3,s.prototype.__generatedMappings=null,Object.defineProperty(s.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),s.prototype.__originalMappings=null,Object.defineProperty(s.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),s.prototype._charIsMappingSeparator=function(n,u){var o=n.charAt(u);return o===";"||o===","},s.prototype._parseMappings=function(n,u){throw new Error("Subclasses must implement _parseMappings")},s.GENERATED_ORDER=1,s.ORIGINAL_ORDER=2,s.GREATEST_LOWER_BOUND=1,s.LEAST_UPPER_BOUND=2,s.prototype.eachMapping=function(n,u,o){var g=u||null,y=o||s.GENERATED_ORDER,S;switch(y){case s.GENERATED_ORDER:S=this._generatedMappings;break;case s.ORIGINAL_ORDER:S=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var C=this.sourceRoot;S.map(function(e){var r=e.source===null?null:this._sources.at(e.source);return r=a.computeSourceURL(C,r,this._sourceMapURL),{source:r,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:e.name===null?null:this._names.at(e.name)}},this).forEach(n,g)},s.prototype.allGeneratedPositionsFor=function(n){var u=a.getArg(n,"line"),o={source:a.getArg(n,"source"),originalLine:u,originalColumn:a.getArg(n,"column",0)};if(o.source=this._findSourceIndex(o.source),o.source<0)return[];var g=[],y=this._findMapping(o,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,_.LEAST_UPPER_BOUND);if(y>=0){var S=this._originalMappings[y];if(n.column===void 0)for(var C=S.originalLine;S&&S.originalLine===C;)g.push({line:a.getArg(S,"generatedLine",null),column:a.getArg(S,"generatedColumn",null),lastColumn:a.getArg(S,"lastGeneratedColumn",null)}),S=this._originalMappings[++y];else for(var e=S.originalColumn;S&&S.originalLine===u&&S.originalColumn==e;)g.push({line:a.getArg(S,"generatedLine",null),column:a.getArg(S,"generatedColumn",null),lastColumn:a.getArg(S,"lastGeneratedColumn",null)}),S=this._originalMappings[++y]}return g},A.SourceMapConsumer=s;function l(t,n){var u=t;typeof t=="string"&&(u=a.parseSourceMapInput(t));var o=a.getArg(u,"version"),g=a.getArg(u,"sources"),y=a.getArg(u,"names",[]),S=a.getArg(u,"sourceRoot",null),C=a.getArg(u,"sourcesContent",null),e=a.getArg(u,"mappings"),r=a.getArg(u,"file",null);if(o!=this._version)throw new Error("Unsupported version: "+o);S&&(S=a.normalize(S)),g=g.map(String).map(a.normalize).map(function(h){return S&&a.isAbsolute(S)&&a.isAbsolute(h)?a.relative(S,h):h}),this._names=M.fromArray(y.map(String),!0),this._sources=M.fromArray(g,!0),this._absoluteSources=this._sources.toArray().map(function(h){return a.computeSourceURL(S,h,n)}),this.sourceRoot=S,this.sourcesContent=C,this._mappings=e,this._sourceMapURL=n,this.file=r}l.prototype=Object.create(s.prototype),l.prototype.consumer=s,l.prototype._findSourceIndex=function(t){var n=t;if(this.sourceRoot!=null&&(n=a.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);var u;for(u=0;u<this._absoluteSources.length;++u)if(this._absoluteSources[u]==t)return u;return-1},l.fromSourceMap=function(n,u){var o=Object.create(l.prototype),g=o._names=M.fromArray(n._names.toArray(),!0),y=o._sources=M.fromArray(n._sources.toArray(),!0);o.sourceRoot=n._sourceRoot,o.sourcesContent=n._generateSourcesContent(o._sources.toArray(),o.sourceRoot),o.file=n._file,o._sourceMapURL=u,o._absoluteSources=o._sources.toArray().map(function(G){return a.computeSourceURL(o.sourceRoot,G,u)});for(var S=n._mappings.toArray().slice(),C=o.__generatedMappings=[],e=o.__originalMappings=[],r=0,h=S.length;r<h;r++){var m=S[r],N=new c;N.generatedLine=m.generatedLine,N.generatedColumn=m.generatedColumn,m.source&&(N.source=y.indexOf(m.source),N.originalLine=m.originalLine,N.originalColumn=m.originalColumn,m.name&&(N.name=g.indexOf(m.name)),e.push(N)),C.push(N)}return f(o.__originalMappings,a.compareByOriginalPositions),o},l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function c(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}l.prototype._parseMappings=function(n,u){for(var o=1,g=0,y=0,S=0,C=0,e=0,r=n.length,h=0,m={},N={},G=[],j=[],B,R,w,K,P;h<r;)if(n.charAt(h)===";")o++,h++,g=0;else if(n.charAt(h)===",")h++;else{for(B=new c,B.generatedLine=o,K=h;K<r&&!this._charIsMappingSeparator(n,K);K++);if(R=n.slice(h,K),w=m[R],w)h+=R.length;else{for(w=[];h<K;)p.decode(n,h,N),P=N.value,h=N.rest,w.push(P);if(w.length===2)throw new Error("Found a source, but no line and column");if(w.length===3)throw new Error("Found a source and line, but no column");m[R]=w}B.generatedColumn=g+w[0],g=B.generatedColumn,w.length>1&&(B.source=C+w[1],C+=w[1],B.originalLine=y+w[2],y=B.originalLine,B.originalLine+=1,B.originalColumn=S+w[3],S=B.originalColumn,w.length>4&&(B.name=e+w[4],e+=w[4])),j.push(B),typeof B.originalLine=="number"&&G.push(B)}f(j,a.compareByGeneratedPositionsDeflated),this.__generatedMappings=j,f(G,a.compareByOriginalPositions),this.__originalMappings=G},l.prototype._findMapping=function(n,u,o,g,y,S){if(n[o]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+n[o]);if(n[g]<0)throw new TypeError("Column must be greater than or equal to 0, got "+n[g]);return _.search(n,u,y,S)},l.prototype.computeColumnSpans=function(){for(var n=0;n<this._generatedMappings.length;++n){var u=this._generatedMappings[n];if(n+1<this._generatedMappings.length){var o=this._generatedMappings[n+1];if(u.generatedLine===o.generatedLine){u.lastGeneratedColumn=o.generatedColumn-1;continue}}u.lastGeneratedColumn=1/0}},l.prototype.originalPositionFor=function(n){var u={generatedLine:a.getArg(n,"line"),generatedColumn:a.getArg(n,"column")},o=this._findMapping(u,this._generatedMappings,"generatedLine","generatedColumn",a.compareByGeneratedPositionsDeflated,a.getArg(n,"bias",s.GREATEST_LOWER_BOUND));if(o>=0){var g=this._generatedMappings[o];if(g.generatedLine===u.generatedLine){var y=a.getArg(g,"source",null);y!==null&&(y=this._sources.at(y),y=a.computeSourceURL(this.sourceRoot,y,this._sourceMapURL));var S=a.getArg(g,"name",null);return S!==null&&(S=this._names.at(S)),{source:y,line:a.getArg(g,"originalLine",null),column:a.getArg(g,"originalColumn",null),name:S}}}return{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(n){return n==null}):!1},l.prototype.sourceContentFor=function(n,u){if(!this.sourcesContent)return null;var o=this._findSourceIndex(n);if(o>=0)return this.sourcesContent[o];var g=n;this.sourceRoot!=null&&(g=a.relative(this.sourceRoot,g));var y;if(this.sourceRoot!=null&&(y=a.urlParse(this.sourceRoot))){var S=g.replace(/^file:\/\//,"");if(y.scheme=="file"&&this._sources.has(S))return this.sourcesContent[this._sources.indexOf(S)];if((!y.path||y.path=="/")&&this._sources.has("/"+g))return this.sourcesContent[this._sources.indexOf("/"+g)]}if(u)return null;throw new Error('"'+g+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(n){var u=a.getArg(n,"source");if(u=this._findSourceIndex(u),u<0)return{line:null,column:null,lastColumn:null};var o={source:u,originalLine:a.getArg(n,"line"),originalColumn:a.getArg(n,"column")},g=this._findMapping(o,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,a.getArg(n,"bias",s.GREATEST_LOWER_BOUND));if(g>=0){var y=this._originalMappings[g];if(y.source===o.source)return{line:a.getArg(y,"generatedLine",null),column:a.getArg(y,"generatedColumn",null),lastColumn:a.getArg(y,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},O=l;function i(t,n){var u=t;typeof t=="string"&&(u=a.parseSourceMapInput(t));var o=a.getArg(u,"version"),g=a.getArg(u,"sections");if(o!=this._version)throw new Error("Unsupported version: "+o);this._sources=new M,this._names=new M;var y={line:-1,column:0};this._sections=g.map(function(S){if(S.url)throw new Error("Support for url field in sections not implemented.");var C=a.getArg(S,"offset"),e=a.getArg(C,"line"),r=a.getArg(C,"column");if(e<y.line||e===y.line&&r<y.column)throw new Error("Section offsets must be ordered and non-overlapping.");return y=C,{generatedOffset:{generatedLine:e+1,generatedColumn:r+1},consumer:new s(a.getArg(S,"map"),n)}})}i.prototype=Object.create(s.prototype),i.prototype.constructor=s,i.prototype._version=3,Object.defineProperty(i.prototype,"sources",{get:function(){for(var t=[],n=0;n<this._sections.length;n++)for(var u=0;u<this._sections[n].consumer.sources.length;u++)t.push(this._sections[n].consumer.sources[u]);return t}}),i.prototype.originalPositionFor=function(n){var u={generatedLine:a.getArg(n,"line"),generatedColumn:a.getArg(n,"column")},o=_.search(u,this._sections,function(y,S){var C=y.generatedLine-S.generatedOffset.generatedLine;return C||y.generatedColumn-S.generatedOffset.generatedColumn}),g=this._sections[o];return g?g.consumer.originalPositionFor({line:u.generatedLine-(g.generatedOffset.generatedLine-1),column:u.generatedColumn-(g.generatedOffset.generatedLine===u.generatedLine?g.generatedOffset.generatedColumn-1:0),bias:n.bias}):{source:null,line:null,column:null,name:null}},i.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(n){return n.consumer.hasContentsOfAllSources()})},i.prototype.sourceContentFor=function(n,u){for(var o=0;o<this._sections.length;o++){var g=this._sections[o],y=g.consumer.sourceContentFor(n,!0);if(y)return y}if(u)return null;throw new Error('"'+n+'" is not in the SourceMap.')},i.prototype.generatedPositionFor=function(n){for(var u=0;u<this._sections.length;u++){var o=this._sections[u];if(o.consumer._findSourceIndex(a.getArg(n,"source"))!==-1){var g=o.consumer.generatedPositionFor(n);if(g){var y={line:g.line+(o.generatedOffset.generatedLine-1),column:g.column+(o.generatedOffset.generatedLine===g.line?o.generatedOffset.generatedColumn-1:0)};return y}}}return{line:null,column:null}},i.prototype._parseMappings=function(n,u){this.__generatedMappings=[],this.__originalMappings=[];for(var o=0;o<this._sections.length;o++)for(var g=this._sections[o],y=g.consumer._generatedMappings,S=0;S<y.length;S++){var C=y[S],e=g.consumer._sources.at(C.source);e=a.computeSourceURL(g.consumer.sourceRoot,e,this._sourceMapURL),this._sources.add(e),e=this._sources.indexOf(e);var r=null;C.name&&(r=g.consumer._names.at(C.name),this._names.add(r),r=this._names.indexOf(r));var h={source:e,generatedLine:C.generatedLine+(g.generatedOffset.generatedLine-1),generatedColumn:C.generatedColumn+(g.generatedOffset.generatedLine===C.generatedLine?g.generatedOffset.generatedColumn-1:0),originalLine:C.originalLine,originalColumn:C.originalColumn,name:r};this.__generatedMappings.push(h),typeof h.originalLine=="number"&&this.__originalMappings.push(h)}f(this.__generatedMappings,a.compareByGeneratedPositionsDeflated),f(this.__originalMappings,a.compareByOriginalPositions)},O=i},615:(T,A,E)=>{var O=E(114),a=E(870),_=E(560).I,M=E(677).H;function p(f){f||(f={}),this._file=a.getArg(f,"file",null),this._sourceRoot=a.getArg(f,"sourceRoot",null),this._skipValidation=a.getArg(f,"skipValidation",!1),this._sources=new _,this._names=new _,this._mappings=new M,this._sourcesContents=null}p.prototype._version=3,p.fromSourceMap=function(s){var l=s.sourceRoot,c=new p({file:s.file,sourceRoot:l});return s.eachMapping(function(i){var t={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(t.source=i.source,l!=null&&(t.source=a.relative(l,t.source)),t.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(t.name=i.name)),c.addMapping(t)}),s.sources.forEach(function(i){var t=i;l!==null&&(t=a.relative(l,i)),c._sources.has(t)||c._sources.add(t);var n=s.sourceContentFor(i);n!=null&&c.setSourceContent(i,n)}),c},p.prototype.addMapping=function(s){var l=a.getArg(s,"generated"),c=a.getArg(s,"original",null),i=a.getArg(s,"source",null),t=a.getArg(s,"name",null);this._skipValidation||this._validateMapping(l,c,i,t),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),t!=null&&(t=String(t),this._names.has(t)||this._names.add(t)),this._mappings.add({generatedLine:l.line,generatedColumn:l.column,originalLine:c!=null&&c.line,originalColumn:c!=null&&c.column,source:i,name:t})},p.prototype.setSourceContent=function(s,l){var c=s;this._sourceRoot!=null&&(c=a.relative(this._sourceRoot,c)),l!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[a.toSetString(c)]=l):this._sourcesContents&&(delete this._sourcesContents[a.toSetString(c)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},p.prototype.applySourceMap=function(s,l,c){var i=l;if(l==null){if(s.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=s.file}var t=this._sourceRoot;t!=null&&(i=a.relative(t,i));var n=new _,u=new _;this._mappings.unsortedForEach(function(o){if(o.source===i&&o.originalLine!=null){var g=s.originalPositionFor({line:o.originalLine,column:o.originalColumn});g.source!=null&&(o.source=g.source,c!=null&&(o.source=a.join(c,o.source)),t!=null&&(o.source=a.relative(t,o.source)),o.originalLine=g.line,o.originalColumn=g.column,g.name!=null&&(o.name=g.name))}var y=o.source;y!=null&&!n.has(y)&&n.add(y);var S=o.name;S!=null&&!u.has(S)&&u.add(S)},this),this._sources=n,this._names=u,s.sources.forEach(function(o){var g=s.sourceContentFor(o);g!=null&&(c!=null&&(o=a.join(c,o)),t!=null&&(o=a.relative(t,o)),this.setSourceContent(o,g))},this)},p.prototype._validateMapping=function(s,l,c,i){if(l&&typeof l.line!="number"&&typeof l.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(s&&"line"in s&&"column"in s&&s.line>0&&s.column>=0&&!l&&!c&&!i)){if(s&&"line"in s&&"column"in s&&l&&"line"in l&&"column"in l&&s.line>0&&s.column>=0&&l.line>0&&l.column>=0&&c)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:s,source:c,original:l,name:i}))}},p.prototype._serializeMappings=function(){for(var s=0,l=1,c=0,i=0,t=0,n=0,u="",o,g,y,S,C=this._mappings.toArray(),e=0,r=C.length;e<r;e++){if(g=C[e],o="",g.generatedLine!==l)for(s=0;g.generatedLine!==l;)o+=";",l++;else if(e>0){if(!a.compareByGeneratedPositionsInflated(g,C[e-1]))continue;o+=","}o+=O.encode(g.generatedColumn-s),s=g.generatedColumn,g.source!=null&&(S=this._sources.indexOf(g.source),o+=O.encode(S-n),n=S,o+=O.encode(g.originalLine-1-i),i=g.originalLine-1,o+=O.encode(g.originalColumn-c),c=g.originalColumn,g.name!=null&&(y=this._names.indexOf(g.name),o+=O.encode(y-t),t=y)),u+=o}return u},p.prototype._generateSourcesContent=function(s,l){return s.map(function(c){if(!this._sourcesContents)return null;l!=null&&(c=a.relative(l,c));var i=a.toSetString(c);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)},p.prototype.toJSON=function(){var s={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(s.file=this._file),this._sourceRoot!=null&&(s.sourceRoot=this._sourceRoot),this._sourcesContents&&(s.sourcesContent=this._generateSourcesContent(s.sources,s.sourceRoot)),s},p.prototype.toString=function(){return JSON.stringify(this.toJSON())},A.h=p},141:(T,A,E)=>{var O,a=E(615).h,_=E(870),M=/(\r?\n)/,p=10,f="$$$isSourceNode$$$";function s(l,c,i,t,n){this.children=[],this.sourceContents={},this.line=l??null,this.column=c??null,this.source=i??null,this.name=n??null,this[f]=!0,t!=null&&this.add(t)}s.fromStringWithSourceMap=function(c,i,t){var n=new s,u=c.split(M),o=0,g=function(){var r=m(),h=m()||"";return r+h;function m(){return o<u.length?u[o++]:void 0}},y=1,S=0,C=null;return i.eachMapping(function(r){if(C!==null)if(y<r.generatedLine)e(C,g()),y++,S=0;else{var h=u[o]||"",m=h.substr(0,r.generatedColumn-S);u[o]=h.substr(r.generatedColumn-S),S=r.generatedColumn,e(C,m),C=r;return}for(;y<r.generatedLine;)n.add(g()),y++;if(S<r.generatedColumn){var h=u[o]||"";n.add(h.substr(0,r.generatedColumn)),u[o]=h.substr(r.generatedColumn),S=r.generatedColumn}C=r},this),o<u.length&&(C&&e(C,g()),n.add(u.splice(o).join(""))),i.sources.forEach(function(r){var h=i.sourceContentFor(r);h!=null&&(t!=null&&(r=_.join(t,r)),n.setSourceContent(r,h))}),n;function e(r,h){if(r===null||r.source===void 0)n.add(h);else{var m=t?_.join(t,r.source):r.source;n.add(new s(r.originalLine,r.originalColumn,m,h,r.name))}}},s.prototype.add=function(c){if(Array.isArray(c))c.forEach(function(i){this.add(i)},this);else if(c[f]||typeof c=="string")c&&this.children.push(c);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+c);return this},s.prototype.prepend=function(c){if(Array.isArray(c))for(var i=c.length-1;i>=0;i--)this.prepend(c[i]);else if(c[f]||typeof c=="string")this.children.unshift(c);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+c);return this},s.prototype.walk=function(c){for(var i,t=0,n=this.children.length;t<n;t++)i=this.children[t],i[f]?i.walk(c):i!==""&&c(i,{source:this.source,line:this.line,column:this.column,name:this.name})},s.prototype.join=function(c){var i,t,n=this.children.length;if(n>0){for(i=[],t=0;t<n-1;t++)i.push(this.children[t]),i.push(c);i.push(this.children[t]),this.children=i}return this},s.prototype.replaceRight=function(c,i){var t=this.children[this.children.length-1];return t[f]?t.replaceRight(c,i):typeof t=="string"?this.children[this.children.length-1]=t.replace(c,i):this.children.push("".replace(c,i)),this},s.prototype.setSourceContent=function(c,i){this.sourceContents[_.toSetString(c)]=i},s.prototype.walkSourceContents=function(c){for(var i=0,t=this.children.length;i<t;i++)this.children[i][f]&&this.children[i].walkSourceContents(c);for(var n=Object.keys(this.sourceContents),i=0,t=n.length;i<t;i++)c(_.fromSetString(n[i]),this.sourceContents[n[i]])},s.prototype.toString=function(){var c="";return this.walk(function(i){c+=i}),c},s.prototype.toStringWithSourceMap=function(c){var i={code:"",line:1,column:0},t=new a(c),n=!1,u=null,o=null,g=null,y=null;return this.walk(function(S,C){i.code+=S,C.source!==null&&C.line!==null&&C.column!==null?((u!==C.source||o!==C.line||g!==C.column||y!==C.name)&&t.addMapping({source:C.source,original:{line:C.line,column:C.column},generated:{line:i.line,column:i.column},name:C.name}),u=C.source,o=C.line,g=C.column,y=C.name,n=!0):n&&(t.addMapping({generated:{line:i.line,column:i.column}}),u=null,n=!1);for(var e=0,r=S.length;e<r;e++)S.charCodeAt(e)===p?(i.line++,i.column=0,e+1===r?(u=null,n=!1):n&&t.addMapping({source:C.source,original:{line:C.line,column:C.column},generated:{line:i.line,column:i.column},name:C.name})):i.column++}),this.walkSourceContents(function(S,C){t.setSourceContent(S,C)}),{code:i.code,map:t}},O=s},870:(T,A)=>{function E(e,r,h){if(r in e)return e[r];if(arguments.length===3)return h;throw new Error('"'+r+'" is a required argument.')}A.getArg=E;var O=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,a=/^data:.+\,.+$/;function _(e){var r=e.match(O);return r?{scheme:r[1],auth:r[2],host:r[3],port:r[4],path:r[5]}:null}A.urlParse=_;function M(e){var r="";return e.scheme&&(r+=e.scheme+":"),r+="//",e.auth&&(r+=e.auth+"@"),e.host&&(r+=e.host),e.port&&(r+=":"+e.port),e.path&&(r+=e.path),r}A.urlGenerate=M;function p(e){var r=e,h=_(e);if(h){if(!h.path)return e;r=h.path}for(var m=A.isAbsolute(r),N=r.split(/\/+/),G,j=0,B=N.length-1;B>=0;B--)G=N[B],G==="."?N.splice(B,1):G===".."?j++:j>0&&(G===""?(N.splice(B+1,j),j=0):(N.splice(B,2),j--));return r=N.join("/"),r===""&&(r=m?"/":"."),h?(h.path=r,M(h)):r}A.normalize=p;function f(e,r){e===""&&(e="."),r===""&&(r=".");var h=_(r),m=_(e);if(m&&(e=m.path||"/"),h&&!h.scheme)return m&&(h.scheme=m.scheme),M(h);if(h||r.match(a))return r;if(m&&!m.host&&!m.path)return m.host=r,M(m);var N=r.charAt(0)==="/"?r:p(e.replace(/\/+$/,"")+"/"+r);return m?(m.path=N,M(m)):N}A.join=f,A.isAbsolute=function(e){return e.charAt(0)==="/"||O.test(e)};function s(e,r){e===""&&(e="."),e=e.replace(/\/$/,"");for(var h=0;r.indexOf(e+"/")!==0;){var m=e.lastIndexOf("/");if(m<0||(e=e.slice(0,m),e.match(/^([^\/]+:\/)?\/*$/)))return r;++h}return Array(h+1).join("../")+r.substr(e.length+1)}A.relative=s;var l=function(){var e=Object.create(null);return!("__proto__"in e)}();function c(e){return e}function i(e){return n(e)?"$"+e:e}A.toSetString=l?c:i;function t(e){return n(e)?e.slice(1):e}A.fromSetString=l?c:t;function n(e){if(!e)return!1;var r=e.length;if(r<9||e.charCodeAt(r-1)!==95||e.charCodeAt(r-2)!==95||e.charCodeAt(r-3)!==111||e.charCodeAt(r-4)!==116||e.charCodeAt(r-5)!==111||e.charCodeAt(r-6)!==114||e.charCodeAt(r-7)!==112||e.charCodeAt(r-8)!==95||e.charCodeAt(r-9)!==95)return!1;for(var h=r-10;h>=0;h--)if(e.charCodeAt(h)!==36)return!1;return!0}function u(e,r,h){var m=g(e.source,r.source);return m!==0||(m=e.originalLine-r.originalLine,m!==0)||(m=e.originalColumn-r.originalColumn,m!==0||h)||(m=e.generatedColumn-r.generatedColumn,m!==0)||(m=e.generatedLine-r.generatedLine,m!==0)?m:g(e.name,r.name)}A.compareByOriginalPositions=u;function o(e,r,h){var m=e.generatedLine-r.generatedLine;return m!==0||(m=e.generatedColumn-r.generatedColumn,m!==0||h)||(m=g(e.source,r.source),m!==0)||(m=e.originalLine-r.originalLine,m!==0)||(m=e.originalColumn-r.originalColumn,m!==0)?m:g(e.name,r.name)}A.compareByGeneratedPositionsDeflated=o;function g(e,r){return e===r?0:e===null?1:r===null?-1:e>r?1:-1}function y(e,r){var h=e.generatedLine-r.generatedLine;return h!==0||(h=e.generatedColumn-r.generatedColumn,h!==0)||(h=g(e.source,r.source),h!==0)||(h=e.originalLine-r.originalLine,h!==0)||(h=e.originalColumn-r.originalColumn,h!==0)?h:g(e.name,r.name)}A.compareByGeneratedPositionsInflated=y;function S(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))}A.parseSourceMapInput=S;function C(e,r,h){if(r=r||"",e&&(e[e.length-1]!=="/"&&r[0]!=="/"&&(e+="/"),r=e+r),h){var m=_(h);if(!m)throw new Error("sourceMapURL could not be parsed");if(m.path){var N=m.path.lastIndexOf("/");N>=0&&(m.path=m.path.substring(0,N+1))}r=f(M(m),r)}return p(r)}A.computeSourceURL=C},180:(T,A,E)=>{E(615).h,A.SourceMapConsumer=E(612).SourceMapConsumer,E(141)},49:(T,A,E)=>{E(685).install()},685:(T,A,E)=>{T=E.nmd(T);var O=E(180).SourceMapConsumer,a=E(17),_;try{_=E(147),(!_.existsSync||!_.readFileSync)&&(_=null)}catch{}var M=E(358);function p(d,v){return d.require(v)}var f=!1,s=!1,l=!1,c="auto",i={},t={},n=/^data:application\/json[^,]+base64,/,u=[],o=[];function g(){return c==="browser"?!0:c==="node"?!1:typeof window<"u"&&typeof XMLHttpRequest=="function"&&!(window.require&&window.module&&window.process&&window.process.type==="renderer")}function y(){return typeof process=="object"&&process!==null&&typeof process.on=="function"}function S(){return typeof process=="object"&&process!==null?process.version:""}function C(){if(typeof process=="object"&&process!==null)return process.stderr}function e(d){if(typeof process=="object"&&process!==null&&typeof process.exit=="function")return process.exit(d)}function r(d){return function(v){for(var L=0;L<d.length;L++){var F=d[L](v);if(F)return F}return null}}var h=r(u);u.push(function(d){if(d=d.trim(),/^file:/.test(d)&&(d=d.replace(/file:\/\/\/(\w:)?/,function(F,b){return b?"":"/"})),d in i)return i[d];var v="";try{if(_)_.existsSync(d)&&(v=_.readFileSync(d,"utf8"));else{var L=new XMLHttpRequest;L.open("GET",d,!1),L.send(null),L.readyState===4&&L.status===200&&(v=L.responseText)}}catch{}return i[d]=v});function m(d,v){if(!d)return v;var L=a.dirname(d),F=/^\w+:\/\/[^\/]*/.exec(L),b=F?F[0]:"",I=L.slice(b.length);return b&&/^\/\w\:/.test(I)?(b+="/",b+a.resolve(L.slice(b.length),v).replace(/\\/g,"/")):b+a.resolve(L.slice(b.length),v)}function N(d){var v;if(g())try{var L=new XMLHttpRequest;L.open("GET",d,!1),L.send(null),v=L.readyState===4?L.responseText:null;var F=L.getResponseHeader("SourceMap")||L.getResponseHeader("X-SourceMap");if(F)return F}catch{}v=h(d);for(var b=/(?:\/\/[@#][\s]*sourceMappingURL=([^\s'"]+)[\s]*$)|(?:\/\*[@#][\s]*sourceMappingURL=([^\s*'"]+)[\s]*(?:\*\/)[\s]*$)/mg,I,x;x=b.exec(v);)I=x;return I?I[1]:null}var G=r(o);o.push(function(d){var v=N(d);if(!v)return null;var L;if(n.test(v)){var F=v.slice(v.indexOf(",")+1);L=M(F,"base64").toString(),v=d}else v=m(d,v),L=h(v);return L?{url:v,map:L}:null});function j(d){var v=t[d.source];if(!v){var L=G(d.source);L?(v=t[d.source]={url:L.url,map:new O(L.map)},v.map.sourcesContent&&v.map.sources.forEach(function(b,I){var x=v.map.sourcesContent[I];if(x){var V=m(v.url,b);i[V]=x}})):v=t[d.source]={url:null,map:null}}if(v&&v.map&&typeof v.map.originalPositionFor=="function"){var F=v.map.originalPositionFor(d);if(F.source!==null)return F.source=m(v.url,F.source),F}return d}function B(d){var v=/^eval at ([^(]+) \((.+):(\d+):(\d+)\)$/.exec(d);if(v){var L=j({source:v[2],line:+v[3],column:v[4]-1});return"eval at "+v[1]+" ("+L.source+":"+L.line+":"+(L.column+1)+")"}return v=/^eval at ([^(]+) \((.+)\)$/.exec(d),v?"eval at "+v[1]+" ("+B(v[2])+")":d}function R(){var d,v="";if(this.isNative())v="native";else{d=this.getScriptNameOrSourceURL(),!d&&this.isEval()&&(v=this.getEvalOrigin(),v+=", "),d?v+=d:v+="<anonymous>";var L=this.getLineNumber();if(L!=null){v+=":"+L;var F=this.getColumnNumber();F&&(v+=":"+F)}}var b="",I=this.getFunctionName(),x=!0,V=this.isConstructor(),Y=!(this.isToplevel()||V);if(Y){var H=this.getTypeName();H==="[object Object]"&&(H="null");var X=this.getMethodName();I?(H&&I.indexOf(H)!=0&&(b+=H+"."),b+=I,X&&I.indexOf("."+X)!=I.length-X.length-1&&(b+=" [as "+X+"]")):b+=H+"."+(X||"<anonymous>")}else V?b+="new "+(I||"<anonymous>"):I?b+=I:(b+=v,x=!1);return x&&(b+=" ("+v+")"),b}function w(d){var v={};return Object.getOwnPropertyNames(Object.getPrototypeOf(d)).forEach(function(L){v[L]=/^(?:is|get)/.test(L)?function(){return d[L].call(d)}:d[L]}),v.toString=R,v}function K(d,v){if(v===void 0&&(v={nextPosition:null,curPosition:null}),d.isNative())return v.curPosition=null,d;var L=d.getFileName()||d.getScriptNameOrSourceURL();if(L){var F=d.getLineNumber(),b=d.getColumnNumber()-1,I=/^v(10\.1[6-9]|10\.[2-9][0-9]|10\.[0-9]{3,}|1[2-9]\d*|[2-9]\d|\d{3,}|11\.11)/,x=I.test(S())?0:62;F===1&&b>x&&!g()&&!d.isEval()&&(b-=x);var V=j({source:L,line:F,column:b});v.curPosition=V,d=w(d);var Y=d.getFunctionName;return d.getFunctionName=function(){return v.nextPosition==null?Y():v.nextPosition.name||Y()},d.getFileName=function(){return V.source},d.getLineNumber=function(){return V.line},d.getColumnNumber=function(){return V.column+1},d.getScriptNameOrSourceURL=function(){return V.source},d}var H=d.isEval()&&d.getEvalOrigin();return H&&(H=B(H),d=w(d),d.getEvalOrigin=function(){return H}),d}function P(d,v){l&&(i={},t={});for(var L=d.name||"Error",F=d.message||"",b=L+": "+F,I={nextPosition:null,curPosition:null},x=[],V=v.length-1;V>=0;V--)x.push(`
    at `+K(v[V],I)),I.nextPosition=I.curPosition;return I.curPosition=I.nextPosition=null,b+x.reverse().join("")}function U(d){var v=/\n    at [^(]+ \((.*):(\d+):(\d+)\)/.exec(d.stack);if(v){var L=v[1],F=+v[2],b=+v[3],I=i[L];if(!I&&_&&_.existsSync(L))try{I=_.readFileSync(L,"utf8")}catch{I=""}if(I){var x=I.split(/(?:\r\n|\r|\n)/)[F-1];if(x)return L+":"+F+`
`+x+`
`+new Array(b).join(" ")+"^"}}return null}function $(d){var v=U(d),L=C();L&&L._handle&&L._handle.setBlocking&&L._handle.setBlocking(!0),v&&(console.error(),console.error(v)),console.error(d.stack),e(1)}function W(){var d=process.emit;process.emit=function(v){if(v==="uncaughtException"){var L=arguments[1]&&arguments[1].stack,F=this.listeners(v).length>0;if(L&&!F)return $(arguments[1])}return d.apply(this,arguments)}}var z=u.slice(0),k=o.slice(0);A.wrapCallSite=K,A.getErrorSource=U,A.mapSourcePosition=j,A.retrieveSourceMap=G,A.install=function(d){if(d=d||{},d.environment&&(c=d.environment,["node","browser","auto"].indexOf(c)===-1))throw new Error("environment "+c+" was unknown. Available options are {auto, browser, node}");if(d.retrieveFile&&(d.overrideRetrieveFile&&(u.length=0),u.unshift(d.retrieveFile)),d.retrieveSourceMap&&(d.overrideRetrieveSourceMap&&(o.length=0),o.unshift(d.retrieveSourceMap)),d.hookRequire&&!g()){var v=p(T,"module"),L=v.prototype._compile;L.__sourceMapSupport||(v.prototype._compile=function(I,x){return i[x]=I,t[x]=void 0,L.call(this,I,x)},v.prototype._compile.__sourceMapSupport=!0)}if(l||(l="emptyCacheBetweenOperations"in d?d.emptyCacheBetweenOperations:!1),f||(f=!0,Error.prepareStackTrace=P),!s){var F="handleUncaughtExceptions"in d?d.handleUncaughtExceptions:!0;try{var b=p(T,"worker_threads");b.isMainThread===!1&&(F=!1)}catch{}F&&y()&&(s=!0,W())}},A.resetRetrieveHandlers=function(){u.length=0,o.length=0,u=z.slice(0),o=k.slice(0),G=r(o),h=r(u)}},336:T=>{"use strict";T.exports=require("aws-sdk")},81:T=>{"use strict";T.exports=require("child_process")},147:T=>{"use strict";T.exports=require("fs")},17:T=>{"use strict";T.exports=require("path")}},J={};function D(T){var A=J[T];if(A!==void 0)return A.exports;var E=J[T]={id:T,loaded:!1,exports:{}};return ee[T](E,E.exports,D),E.loaded=!0,E.exports}D.n=T=>{var A=T&&T.__esModule?()=>T.default:()=>T;return D.d(A,{a:A}),A},D.d=(T,A)=>{for(var E in A)D.o(A,E)&&!D.o(T,E)&&Object.defineProperty(T,E,{enumerable:!0,get:A[E]})},D.o=(T,A)=>Object.prototype.hasOwnProperty.call(T,A),D.r=T=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})},D.nmd=T=>(T.paths=[],T.children||(T.children=[]),T);var Q={};(()=>{"use strict";D.r(Q),D.d(Q,{isS3FileTooBig:()=>N,lambdaHandleEvent:()=>j,scanS3Object:()=>B,sizeOf:()=>m});var T=D(49),A=D(336),E=D.n(A),O=D(17),a=D.n(O);const _=require("crypto");var M=D.n(_),p=D(147),f=D.n(p);const s=D(336),l=D(147),c=D(81),i=D(17),t=D(921),n=D(622),u=new s.S3;async function o(R){try{return(await u.listObjectsV2({Bucket:R}).promise()).Contents.map(P=>P.Key)}catch(w){throw n.generateSystemMessage("Error listing files"),console.error(w),w}}const g=()=>{try{const R=c.execSync(`${t.PATH_TO_FRESHCLAM} --config-file=${t.FRESHCLAM_CONFIG} --datadir=${t.FRESHCLAM_WORK_DIR}`);return n.generateSystemMessage("Update message"),console.log(R.toString()),console.log("Downloaded:",l.readdirSync(t.FRESHCLAM_WORK_DIR)),R.stderr&&(n.generateSystemMessage("stderr"),console.log(R.stderr.toString())),!0}catch(R){return console.log(R),!1}},y=async()=>{n.generateSystemMessage("Downloading Definitions");const K=(await o(t.CLAMAV_BUCKET_NAME)).filter(P=>P.startsWith(t.PATH_TO_AV_DEFINITIONS)).map(P=>i.basename(P)).map(P=>new Promise((U,$)=>{const W=i.join(t.FRESHCLAM_WORK_DIR,P);n.generateSystemMessage(`Downloading ${P} from S3 to ${W}`);const z=l.createWriteStream(W),k={Bucket:t.CLAMAV_BUCKET_NAME,Key:`${t.PATH_TO_AV_DEFINITIONS}/${P}`};u.getObject(k).createReadStream().on("end",function(){n.generateSystemMessage(`Finished download ${P}`),U()}).on("error",function(v){n.generateSystemMessage(`Error downloading definition file ${P}`),console.log(v),$()}).pipe(z)}));return await Promise.all(K)},S=async()=>{n.generateSystemMessage("Uploading Definitions");const R=await o(t.CLAMAV_BUCKET_NAME);console.log("Kristinu1: uploadAVDefinitions s3AllFullKeys: ",R);const w=R.filter(U=>U.startsWith(t.PATH_TO_AV_DEFINITIONS));if(console.log("Kristinu2: uploadAVDefinitions s3DefinitionFileFullKeys: ",w),w.length!=0)try{await u.deleteObjects({Bucket:t.CLAMAV_BUCKET_NAME,Delete:{Objects:w.map(U=>({Key:U}))}}).promise(),n.generateSystemMessage(`Deleted extant definitions: ${w}`)}catch(U){throw n.generateSystemMessage(`Error deleting current definition files: ${w}`),console.log(U),U}const P=l.readdirSync(t.FRESHCLAM_WORK_DIR).map(U=>new Promise(($,W)=>{n.generateSystemMessage(`Uploading updated definitions for file ${U} ---`);const z={Bucket:t.CLAMAV_BUCKET_NAME,Key:`${t.PATH_TO_AV_DEFINITIONS}/${U}`,Body:l.createReadStream(i.join(t.FRESHCLAM_WORK_DIR,U))};u.putObject(z,function(k,d){if(k){n.generateSystemMessage(`--- Error uploading ${U} ---`),console.log(k),W();return}$(),console.log(d.toString()),n.generateSystemMessage(`--- Finished uploading ${U} ---`)})}));return await Promise.all(P)},C=R=>{try{console.log("Kristin1: %s and pathToFile: ",t.FRESHCLAM_WORK_DIR,R);const w=c.spawnSync(t.PATH_TO_CLAMAV,["--stdout","-v","-a","-d",t.FRESHCLAM_WORK_DIR,`${t.TMP_DOWNLOAD_PATH}${R}`]);return w.status===1?(n.generateSystemMessage("SUCCESSFUL SCAN, FILE INFECTED"),t.STATUS_INFECTED_FILE):w.status!==0?(n.generateSystemMessage("-- SCAN FAILED WITH ERROR --"),console.error("stderror",w.stderr.toString()),console.error("stdout",w.stdout.toString()),console.error("err",w.error),t.STATUS_ERROR_PROCESSING_FILE):(n.generateSystemMessage("SUCCESSFUL SCAN, FILE CLEAN"),console.log(w.stdout.toString()),t.STATUS_CLEAN_FILE)}catch(w){return n.generateSystemMessage("-- SCAN FAILED --"),console.log(w),t.STATUS_ERROR_PROCESSING_FILE}};var e=D(622),r=D(921);const h=new(E()).S3;async function m(R,w){return console.log("key: "+R),console.log("bucket: "+w),(await h.headObject({Key:R,Bucket:w}).promise()).ContentLength}async function N(R,w){return await m(R,w)>r.MAX_FILE_SIZE}function G(R,w){f().existsSync(r.TMP_DOWNLOAD_PATH)||f().mkdirSync(r.TMP_DOWNLOAD_PATH);const K=`${M().randomUUID()}.tmp`,P=`${r.TMP_DOWNLOAD_PATH}${K}`,U=f().createWriteStream(P);e.generateSystemMessage(`Downloading file s3://${w}/${R}`);const $={Bucket:w,Key:R};return new Promise((W,z)=>{h.getObject($).createReadStream().on("end",function(){e.generateSystemMessage(`Finished downloading new object ${R}`),W(K)}).on("error",function(k){console.log(k),z()}).pipe(U)})}async function j(R){e.generateSystemMessage("Start Antivirus Lambda function");const w=e.extractKeyFromS3Event(R),K=e.extractBucketFromS3Event(R);e.generateSystemMessage(`S3 Bucket and Key
 ${K}
${w}`);let P;if(await N(w,K))P=r.STATUS_SKIPPED_FILE,e.generateSystemMessage(`S3 File is too big. virusScanStatus=${P}`);else{e.generateSystemMessage("Download AV Definitions"),await y(r.CLAMAV_BUCKET_NAME,r.PATH_TO_AV_DEFINITIONS),e.generateSystemMessage("Download File from S3");const $=await G(w,K);e.generateSystemMessage("Set virusScanStatus"),console.log("Kristin 1 lambdaHandleEvent file path: ",$),P=C($),e.generateSystemMessage(`virusScanStatus=${P}`)}const U={Bucket:K,Key:w,Tagging:e.generateTagSet(P)};try{await h.putObjectTagging(U).promise(),e.generateSystemMessage("Tagging successful")}catch($){console.log($)}return P}async function B(R,w){await y(r.CLAMAV_BUCKET_NAME,r.PATH_TO_AV_DEFINITIONS),await G(R,w);const K=C(a().basename(R)),P={Bucket:w,Key:R,Tagging:e.generateTagSet(K)};try{await h.putObjectTagging(P).promise(),e.generateSystemMessage("Tagging Successful"),h.putObjectTagging(P,function(U,$){U?console.log(U,U.stack):console.log($)})}catch(U){console.log(U)}return K}})();var Z=exports;for(var q in Q)Z[q]=Q[q];Q.__esModule&&Object.defineProperty(Z,"__esModule",{value:!0})})();

//# sourceMappingURL=antivirus.js.map